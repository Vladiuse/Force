{% extends 'office/base.html' %}
{% block content %}
<style>
  .test{
    border-width: 1px;
    border-color: aqua;
  }
  .not-copy::selection{
    background: transparent;
  }
  .not-copy::-moz-selection {
   background: transparent;
}
  .badge{
    margin-top: 3px;
  }
  #exampleFormControlTextarea1{
    height: 500px;
  }
</style>

<div class="main-wrapper">
  
    <h2>–°—à—ã–≤–∞—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫</h2>
    <!-- <form class=""> -->
      
    <!-- <div class="container-sm"> -->
      <div class="row">
        <div class="col-3 test">
          <select class="form-control form-control-lg" id="select-baer">
            <option value="none">–í—ã–±–µ—Ä–µ—Ç–µ –ë–∞–µ—Ä–∞</option>
                 <option value="ignat" class="baer" >–ò–≥–Ω–∞—Ç &#127752</option>
                 <option value="sergey" class="baer">–°–µ—Ä–≥–µ–π &#128507</option>
                <option value="sashko" class="baer">–°–∞—à–∫–æ üá∫üá∏</option>
          </select>
        </div>
        <div class="col-1 test"></div>
        <div class="col-8 test"></div>
      </div>
      
      <div class="row">
        <div class="col-3 test">
          <div class="form-group">
            <label for="exampleFormControlTextarea1" >–í—Å—Ç–∞–≤—Ç–µ –¥–æ–º–µ–Ω—ã</label>
            <textarea class="form-control" id="exampleFormControlTextarea1" disabled rows="3"></textarea>
          </div>
        </div>
        <div class="col-1 test">
          <label for="exampleFormControlTextarea1" class="not-copy">–ü—Ä–æ–≤–µ—Ä–∫–∞</label><br>
          
          <div id="status-codes">
            <!-- <span class="badge bg-success">200</span><br>
            <span class="badge bg-success">200</span><br>
            <span class="badge bg-danger">404</span><br> -->
          </div>
        </div>
        <div class="col-8 test">
          
            <label for="exampleFormControlTextarea1" class="not-copy">–†–µ–∑—É–ª—å—Ç–∞—Ç</label>
            <div id="result-area">
              
            </div>
          
        </div>
      </div>
      <button class="btn btn-primary" disabled id="check-urls">Check Urls</button>
    <!-- </div> -->
  <!-- </form> -->
  <!-- <div class="container-sm"> -->
    
      
         
      
        


        
  <!-- </div> -->
</div>
{% verbatim %}
<script>
  let baer = 'BAER';
  domain_tail = `?bay=${baer}&adset_name={{adset.name}}&ad_id={{ad.id}}&fbp=xxxxxx`
  let PROTOKOL = location.protocol;
  let urls_w_protokol = []
  // –ø—Ä–æ—Å—Ç–∞–≤–∫–∞ –±–∞–µ—Ä–∞
  $('#select-baer').change(function(){
    var baer = $(this).val();
    domain_tail = `?bay=${baer}&adset_name={{adset.name}}&ad_id={{ad.id}}&fbp=xxxxxxxxxx`
    if (baer == 'none'){$('#exampleFormControlTextarea1').attr('disabled', 'disabled')}
    else {
      $('#exampleFormControlTextarea1').removeAttr('disabled')
    }
  })
  $('#check-urls').click(function(){
    $('#status-codes').empty();
    // console.log('empty')
    // console.log('start check')
    for (i in urls_w_protokol){
      let url = urls_w_protokol[i]
      $.ajax({
        url  : url,
        async: false,
        type : 'get',
        success: function(data, textStatus, xhr){addStatusCode(xhr.status); console.log(xhr.status, 'status_code', url)},
        error: function(data, textStatus, xhr){addStatusCode(xhr.status); console.log(xhr.status, 'status_code', url)},
      })
      
    }
  })
  $('#exampleFormControlTextarea1').blur(function(){
    domains = getDomainsFromForm();
    join_doms = joinDomains(domains);
    urls_w_protokol = join_doms;
    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–º–µ–Ω–æ–≤ —Å–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Å—ã–ª–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ–π
    if (urls_w_protokol.length >0){$('#check-urls').removeAttr('disabled')}
    showResult(join_doms);
  })

  
  // –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ —Å —Ç–µ–∫—Å-–∞—Ä–µ–∞
  function getDomainsFromForm(){
    domains_text = $('#exampleFormControlTextarea1').val();
    domains = domains_text.split('\n')
    return domains
  }
  // —Å—à–∏—Ç—å –¥–æ–º–µ–Ω—ã
  function joinDomains(domains){
    joins = []
    for (i in domains){
      // –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª
      if (domains[i].startsWith('http')){
        dom = domains[i]
        joins.push(dom)
      }
      else if (domains[i] != '') {
        join_dom = `${PROTOKOL}//${domains[i]}/${domain_tail}`
        joins.push(join_dom)
      }
      
    }
    return joins
  }
  // –≤—ã–≤–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  function showResult(join_doms){
    $('#result-area').empty();
    for (i in join_doms){      
        $('#result-area').append(join_doms[i] + '<br>')
      }
  }
  // –ø—Ä–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ 
  function addStatusCode(status){
    if (status == 200){
      result_span = `<span class="badge bg-success">${status}</span><br>`
    }
    else if (status === undefined) {
      result_span = `<span class="badge bg-danger">Error</span><br>`
    }
    else {
      result_span = `<span class="badge bg-danger">${status}</span><br>`
    }
    $('#status-codes').append(result_span)
  }
</script>
{% endverbatim %}
{% endblock %}