{% extends 'vagons/base.html' %}

{%block page-name%}Сверка списков номеров контейнеров v0.2{%endblock%}
{%block content%}
<style>
    .container-fluid{
        padding: 0 20px;
    }
    textarea{
        width: 100%;
        height: 200px;
    }
    .pure-material-switch{
        margin-bottom: 15px;
    }
</style>

<div class="container-fluid">
    <label class="pure-material-switch">
        <input id="spellcheck" type="checkbox" checked>
        <span>Строки целиком</span>
    </label>
    <div class="row">
        <div class="col">
            <h3>{{file_name_1}} (найдено {{reader.file_1.containers|length}}шт.)</h3>
        </div>
        <div class="col">
            <!-- NONE -->
        </div>
        <div class="col">
            <h3>{{file_name_2}} (найдено {{reader.file_2.containers|length}}шт.)</h3>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h5>Уникальные контейнеры ({{reader.file_1.containers.unique|length}}шт.)</h5>
            <textarea disabled class="form-control" id="file_1_unique_containers"></textarea>
        </div>
        <div class="col">
            <h5>Общие контейнеры (0шт.)</h5>
            <textarea disabled class="form-control" id="common_containers"></textarea>
        </div>
        <div class="col">
            <h5>Уникальные контейнеры ({{reader.file_2.containers.unique|length}}шт.)</h5>
            <textarea disabled class="form-control" id="file_2_unique_containers"></textarea>
        </div>
    </div>
    <h5>Некоректные номера контейнеров</h5>
    <div class="row">
        <div class="col">
            <textarea disabled class="form-control" id="incorrect_1"></textarea>
        </div>
        <div class="col">
       <!-- NONE -->
        </div>
        <div class="col">
            <textarea disabled class="form-control" id="incorrect_2"></textarea>
        </div>
    </div>
    <h5>Строки без номеров контейнеров</h5>
    <div class="row">
        <div class="col">
            <textarea disabled class="form-control" id="file_1_no_conteiner_list"></textarea>
        </div>
        <!-- <div class="col">
       NONE
        </div> -->
        <div class="col">
            <textarea disabled class="form-control" id="file_2_no_conteiner_list"></textarea>
        </div>
    </div>
</div>
<script>
    let xxx = JSON.parse('{{reader.unique_containers_file_1.json|safe}}')
    let result_containers = {
        'file_1_unique_containers': JSON.parse('{{reader.unique_containers_file_1.json|safe}}'),
        'file_2_unique_containers': JSON.parse('{{reader.unique_containers_file_2.json|safe}}'),
        'common_containers': JSON.parse('{{reader.common_containers.json|safe}}'),
        'incorrect_1': JSON.parse('{{reader.incorrect_1|safe}}'),
        'incorrect_2': JSON.parse('{{reader.incorrect_2|safe}}'),
    };
    let result_no_containers = {
        'file_1_no_conteiner_list': JSON.parse('{{reader.file_1.get_no_containers_lines_json|safe}}'),
        'file_2_no_conteiner_list': JSON.parse('{{reader.file_2.get_no_containers_lines_json|safe}}'),
    };

    function uploadData(){
        let flag = 'text_line'
        if ($('#spellcheck').prop('checked')){flag='id'}
        for (key in result_containers){
            let list_data = result_containers[key]
            console.log(list_data)
            let data_to_show = []
            for (i in list_data){
                data_to_show.push(list_data[i][flag])
            }
            let textarea = $('#'+key)
            textarea.val(data_to_show.join('\n'));
        }
    }
    uploadData()

    function addNoContainerLines(){
        // Добавить строки в которых нет номеров контейнеров
        for (key in result_no_containers){
            let data = result_no_containers[key].join('\n');
            console.log(data)
            let textarea = $('#'+key)
            textarea.val(data)
        }
    }
    addNoContainerLines()


    $('#spellcheck').click(function(){
        if ($('#spellcheck').prop('checked'))
        {$('.pure-material-switch span').text('Строки целиком')}
        else
        { $('.pure-material-switch span').text('Только номера')}
        uploadData()
    })
</script>
{%endblock%}